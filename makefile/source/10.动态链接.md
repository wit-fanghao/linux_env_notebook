# 链接动态库

## Creating a Shared Library

### 第一种方法

先转成.o文件，再编成.so文件

1. 编译二进制`.o` 文件

   ```
   gcc -c -fPIC [.c源文件] [.c源文件] [...]
   ```

   使用`-fpic`或者`-fPIC`属性生成与位置无关的中间文件

   - `-fpic`：
   - `-fPIC`：

   

2. 编译生成`.so`动态库

   ```
   gcc -shared [.o文件] [.o文件] [...] -o lib[库名].so
   ```

   使用`-shared`属性生成共享库

### 第二种方法

直接转成.so

```
gcc -fPIC -shared [.c源文件] [.c源文件] [...] -o lib[库名].so
```



## 链接动态库

链接动态库到可执行文件

```
gcc [main相关文件] -o [自定义可执行文件名]  -l[库名] -L[库路径] -Wl,-rpath=[库路径]
```



## 问题说明

```
make[1]: Entering directory `/opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp'
make[1]: warning: jobserver unavailable: using -j1.  Add `+' to parent make rule.
make -C /opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp/../udr udr_app V=
make -C main_loop V=
"22222222222222222222222222222222222222222222222222222222"
aarch64-fhlinux-linux-gcc -DOS=LINUX -DHOST=OSIX_LITTLE_ENDIAN -D__LITTLE_ENDIAN_BITFIELD -DINET6 -DHAVE_IPV6  -DBCM_WANTED -DCONFIG_OS_LINUX -DOUTBANDIF_WANTED -DCOMBO_WANTED -DUSERIO_WANTED -DSWNETFLOW_WANTED -DHWDEV_WANTED    -DUSP_ROS_SWITCH  -DUINET_WANTED -DGCC_ATOMIC_SUPPORT -DUINET_BIG_MEMORY  -DUINETSCK_WANTED -DUINETSCK_TUNL=MSGQ -DDIRECTROUTECOST_WANTED -DUINET_BIG_MEMORY        -DUSPIF_WANTED -DETHIF_WANTED -DETHSUBIF_WANTED -DVLANIF_WANTED -DLOOPBACKIF_WANTED -DNULLIF_WANTED -DETHAGGIF_WANTED -DTUNNELIF_WANTED -DSTACKIF_WANTED -DVXLAN_WANTED -DBDIF_WANTED -DNVEIF_WANTED -DL2NET_WANTED -DHWVP_WANTED -DHWBD_WANTED -DETHAGGSUBIF_WANTED -DVXLAN -DPVLAN_WANTED -DNVEIF_IPV6_WANTED -DPROTOCOLSTATS_WANTED -DUINET_BIG_MEMORY  -DANTIARP_WANTED -DARP_ANTIATTACK_WANTED -DARP_ANTIATTACK_ALARM_WANTED -DARP_ANTIATTACK_TRUNK_WANTED  -DUINET_BIG_MEMORY  -DANTIATTACK_WANTED  -DARPL2PROXY_WANTED  -DNDL2PROXY_WANTED  -DSTGSHARE_WANTED    -DCPUDEFEND_WANTED -DCPUDEFEND_STATISTICS_WANTED -DCPUDEFEND_CIRxx -DCPUDEFEND_PPS -DCPUDEFEND_UINET_WANTED -DCPUDEFEND_ATTACKSOURCE_TRACE_WANTED -DCPUDEFEND_ATTACKSOURCE_TRACE_ALARM_WANTED -DCPUDEFEND_WHITE_LIST_WANTED -DCPUDEFEND_BLACK_LIST_WANTED  -DRTADVD_WANTED  -DIFDIV3_WANTED -DCLI_WANTED -DSIMULANT_CLOCK_WANTED -DVLAN_WANTED -DDOUBLE_OS_WANTEDxx -DDOUBLE_CFG_WANTEDxx -DIP_SUB_WANTED -DIPV6_SUB_WANTED -DTFTP_WANTED -DTFTP_IPV6_WANTED -DFTP_WANTED -DFTP_IPV6_WANTED -DINDEX3DIMEN_WANTED -DFULL_VLAN_SUPPORT -DODM_WANTED -DIF_WANTED -DIPV4_WANTED -DIPV6_WANTED -DDIAGSHELL_WANTED -DSTDENTITY_WANTED -DPWDRECOVER_WANTED -DGLOBALMTU_WANTEDxx -DUDR_WANTED -DCPUPKT_WANTED -DSMTP_WANTED -DARPLIMIT_WANTED -DSWITCH_IF_WANTED -DRATELIMIT_TRUNK_WANTED -DUNKNOWNUCAST_IF_WANTED -DUNKNOWNMCAST_IF_WANTED -DL2NET_WANTED -DVXLAN_WANTED -DBDIF_WANTED -DNVEIF_WANTED -DUNKNOWNMCAST_GLOBAL_WANTED -DUNKNOWNUNICAST_GLOBAL_WANTED -DETHIF_MDI_WANTED -DIPV6_ROUTEMETRIC_WANTED -DROUTEMETRIC_WANTED -DURPF_WANTED -DTRAFFIC_IFQ_WANTED -DSUPERVLAN_WANTED -DARPPROXY_WANTED -DETHIF_ROUTE_WANTED -DCONSOLE_NAME="/dev/ttyS0" -DETHIF_UPDELAYTIME_WANTED -DETHIF_DOWNDELAYTIME_WANTED -DETHIF_FLOWCTRLNEGOTIATION_WANTED -DETHIF_COMBO_WANTED -DETHIF100G_WANTED -DETHIF1000M_WANTEDxx -DETHIF10G_WANTED -DETHIF40G_WANTED -DETHIF25G_WANTED -DRATELIMIT_ONLY_OUTxx -DETHAGGIF_ROUTE_WANTED -DVXLAN_PING_WANTED -DVXLAN_TRACE_WANTED -DETHIF_IPV6_ROUTE_WANTED -DVXLAN_VNIMAP_WANTEDxx -DETHIF_FEC_WANTED -DETHIF_IFG_WANTED -DETHIF_STATSFRAME_WANTED -DOSFILE_WANTED -DVXLAN_VNIMAP_WANTED -DSYSLOG_WANTED -DFILTER_ACTION_IP_URPF_DISABLE_WANTED -DIF_PKTSTATISTIC_WANTED -DPARTICULARSTAT_NOT_SUPxx -DSGM3_WANTED -DAUTOXLOAD_WANTED -DAUTOSAVE_WANTED -DCAM_WANTED -DSNMP_WANTED -DSNMP_TIMERTRAP_WANTED -DRATELIMIT_ONLY_OUT -DL3VPN_WANTED -DPTP_WANTED  -DSNMP_WANTED -DHEARTBEATTRAP_WANTEDx -DDEVICE_WANTED -DTRAP_VLANIF_WANTED -DTRAP_LOOPBACKIF_WANTED -DTRAP_ETHIF_ROUTE_WANTED -DTRAP_ETHAGGIF_ROUTE_WANTED -DTRAP_ETHSUBIF_ROUTE_WANTED -DETHIF_ROUTE_WANTED -DETHSUBIF_ROUTE_WANTED  -DNETCONF_WANTED -DUSE_NONBLOCKING_IO  -DRMON_WANTED -DRMON_TRUNK_WANTED  -DSHELL_WANTED  -DTRAP_HISTORY_WANTED  -DSSHD_WANTED        -DSOA_WANTED -DSOA_OSIMAGE_WANTED -DSOA_FPGA_WANTED -DSOA_CMU_WANTEDxx -DSOA_BIOS_WANTED -DSOA_CONFIG_WANTED -DUPGRADE_FPGA_WANTED  -DAAA_WANTED -DAAA_TACACS_WANTED -DDOT1X_WANTED  -DARPPROBE_WANTED  -DFILTER_WANTED -DACL_MATCH_WANTED -DACL_NAT_WANTED -DACL_HQOS_WANTED -DACL_CPUDEFEND_WANTED -DIF_SUPPORT_MULTI_FILTERxx -DFILTER_TRUNK_WANTED -DFILTER_IPV6_WANTED -DFILTER_HYBRID_WANTED -DFILTER_ACT_COS_WANTED -DFILTER_STATS_WANTED -DCOUNTER_WANTED -DCOUNTER_SORTTYPE_TOTAL_WANTED -DMETER_WANTED -DFILTER_MIRROR_GROUP_WANTED -DFILTER_GLOBAL_DIRECTION_WANTED -DFILTER_ACT_INSERTOUTER_WANTED -DFILTER_ACT_REPLACEOUTER_WANTED -DFILTER_ACT_INSERT_REPLACE_INNER_WANTED -DFILTER_ACT_OUTPUT_IF_WANTED -DFILTER_ACT_OUTPUT_TRUNK_WANTED -DFILTER_ACT_REMOVE_INNER_WANTED -DFILTER_ACT_REMOVE_OUTER_WANTED -DFILTER_MACMASK_WANTED -DFILTER_VLAN_WANTED -DFILTER_VXLAN_WANTED -DFILTER_MACMASK_WANTED -DFILTER_IPMASK_WANTED -DFILTER_ICMPMASK_WANTED -DFILTER_IGMPMASK_WANTED -DFILTER_TCPMASK_WANTED -DFILTER_UDPMASK_WANTED -DFILTER_REDIRECT_CPU_WANTED -DMETER_COLOR_DROP -DMETER_REMARK_DSCP -DMETER_REMARK_DOT1P -DMETER_REMARK_CFI -DFILTER_OUTER_INNER_PRIORITY_WANTED -DFILTER_STATS_TOTAL_WANTED -DFILTER_ARP_WANTED -DFILTER_ARPMASK_WANTED      -DALB_WANTED -DALB_TRUNK_WANTED  -DBPDU_TUNNEL_WANTED -DBPDU_TRUNK_WANTED -DBPDUTUNNEL_ROLE_WANTED  -DDDM_WANTED  -DDHCPSNOOP_WANTED -DDHCPSNOOP_TRUNK_WANTED -DDHCP6SNOOP_WANTED -DDHCP6SNOOP_TRUNK_WANTED  -DDIFFSERV_WANTED -DDIFFSERV_DOMAIN_IF_WANTED -DDIFFSERV_8021P_OUT_WANTED -DDIFFSERV_IPDSCP_OUT_WANTED  -DDNS_WANTEDxx  -DCFM_WANTED  -DDOT1X_WANTED -DEAPOL_WANTED  -DFLUSH_WANTED -DFLUSH_TRUNK_WANTED  -DG8032_WANTED -DG8032_TRUNK_WANTED  -DHWVP_WANTED  -DIFSTATISTIC_WANTED -DIFSTATISTIC_STATISTIC_ALL -DIFSTATISTIC_INTERFACE_DESC -DIFSTATISTIC_WORKMODExx  -DIGMPSNOOP_WANTED -DIGMPSNOOP_SSM_WANTEDx -DIGMPSNOOPV1V2_WANTEDx -DIGMPSNOOPING_MVLAN_FORWARDMAC_WANTED -DIGMPSNOOPING_MVLAN_FORWARDIP_WANTEDx -DIGMPCTRL_WANTED -DUNKNOWNMCAST_IF_WANTEDx -DIGMPSNOOP_TRUNK_WANTED -DIGMPSNOOPING_MVLAN_FORWARDIP_WANTED -DIGMPSNOOP_MVR_WANTED -DIGMPSNOOP_IPMCDOVLAN_WANTED  -DIPSG_WANTED -DIPSG_IPV6_WANTED -DIPSG_ALARM_WANTED -DIPSG_VLAN_WANTED  -DIPSUBNETVLAN_WANTED -DIPSUBNETVLAN_PRI_WANTED -DIPSUBNETVLAN_PRECEDENCE  -DISS_WANTED -DISSIFSHUT_WANTED  -DLACP_WANTED  -DLINKFLAP_WANTED  -DLLDP_WANTED -DLLDP_STANDARD_MIBx -DLLDPDOT1_WANTED -DLLDPDOT3_WANTED -DLLDPDOT3_WANTED -DLLDP_OUTBANDIF_WANTED -DLLDPMED_WANTED -DLLDPIPV6_WANTED  -DMACVLAN_WANTED -DMACVLAN_PRI_WANTED  -DMAD_WANTED -DMAD_ARP_WANTEDxx -DMAD_BACKUP  -DMAM_WANTED -DMACLIMIT_WANTED -DMACLIMIT_ACTION_WANTED -DPORTSECURITY_WANTED -DMACTRUNK_WANTED -DMACLIMIT_TRUNK_WANTED -DMAM_SWMACLMT_WANTED -DMAM_SWVLANMACLMT_WANTED -DVLANMACLEARNING_WANTED -DVLANMACLIMIT_WANTED -DMAM_NOTITYSEND_WANTED -DMAM_MLAG_WANTED -DMAM_SWBDMACLMT_WANTED -DBDMACLEARNING_WANTED -DBDMACLIMIT_WANTED  -DMIRROR_WANTED -DMIRROR_RSPAN_WANTED -DMIRROR_IF_WANTED -DMIRROR_TRUNK_WANTED -DMIRROR_TOTRUNK_WANTED  -DMLDSNOOP_WANTED -DMLDSNOOP_IPMCDOVLAN_WANTED -DMLDSNOOP_TRUNK_WANTED -DMLDSNOOP_FORWARDMODE_MAC -DMLDSNOOP_FORWARDMODE_IP  -DMLINK_WANTED -DMLINK_TRUNK_WANTED -DMLINK_UPLINKBACKUP_WANTED  -DSTP_WANTED -DSTP_TRUNK_WANTED -DSTP_PROCESS_WANTED -DSTP_MLAG_WANTED  -DMVRP_WANTED  -DNETFLOW_WANTED  -DPORTISOLATE_WANTED -DPORTISOLATE_TRUNK_WANTED  -DPPPOEPLUS_WANTEDxx  -DPROTOVLAN_WANTED  -DPROCSHELL_WANTED  -DDEVCOMM_WANTED  -DQINQ_WANTED -DQINQ_MATCHUNTAG_WANTED -DQINQ_MATCHVLAN8021P_WANTED -DQINQ_MATCH8021P_WANTED -DQINQ_MATCHVLAN_8021PRANGE_WANTED -DQINQ_MATCH8021PRANGE_WANTED -DQINQ_TRUNK_WANTED -DIF_QINQPROTOCOL_WANTED  -DQUEUE_WANTED -DQUEUE_IF_WANTED -DQUEUE_BW_WANTED -DQUEUE_WEIGHT_WANTED -DQUEUE_PRIMAP_WANTED  -DRLINK_WANTED -DRLINK_TRUNK_WANTED  -DSCHEDULE_PROFILE_WANTED -DSCHEDULEPROFILE_WANTED -DSCHEDULEPROFILE_TRUNKIF_WANTED -DSCHEDULEPROFILE_UNKNOWNUNICAST_WANTED -DSCHEDULEPROFILE_ECMPGLOBAL_WANTED -DECMP_PROFILE_WANTED -DECMP_HASHMODE_WANTED -DSCHEDULEPROFILE_IPV4FIELD_WANTED -DSCHEDULEPROFILE_IPV6FIELD_WANTED -DSCHEDULEPROFILE_IPFIELD_SRCIP_WANTED -DSCHEDULEPROFILE_IPFIELD_DSTIP_WANTED -DSCHEDULEPROFILE_IPFIELD_VLAN_WANTED -DSCHEDULEPROFILE_IPFIELD_L4SRCPORT_WANTED -DSCHEDULEPROFILE_IPFIELD_L4DSTPORT_WANTED -DSCHEDULEPROFILE_IPFIELD_PROTOCOL_WANTED -DSCHEDULEPROFILE_HASHMODE_WANTED -DSCHEDULEPROFILE_IPFIELD_SRCPORT_WANTED -DSCHEDULEPROFILE_IPFIELD_DSTPORT_WANTED -DSCHEDULEPROFILE_L2FIELD_WANTED -DSCHEDULEPROFILE_L2FIELD_SRCMAC_WANTED -DSCHEDULEPROFILE_L2FIELD_DSTMAC_WANTED -DSCHEDULEPROFILE_L2FIELD_L2PROTOCOL_WANTED -DSCHEDULEPROFILE_L2FIELD_VLAN_WANTED -DSCHEDULEPROFILE_L2FIELD_SRCPORT_WANTED -DSCHEDULEPROFILE_L2FIELD_DSTPORT_WANTED -DSCHEDULEPROFILE_MPLSFIELD_WANTED -DSCHEDULEPROFILE_MPLSFIELD_TOPLABEL_WANTED -DSCHEDULEPROFILE_MPLSFIELD_2NDLABEL_WANTED -DSCHEDULEPROFILE_MPLSFIELD_SRCIP_WANTED -DSCHEDULEPROFILE_MPLSFIELD_DSTIP_WANTED -DSCHEDULEPROFILE_MPLSFIELD_VLAN_WANTED -DSCHEDULEPROFILE_MPLSFIELD_SRCPORT_WANTED -DSCHEDULEPROFILE_MPLSFIELD_DSTPORT_WANTED -DSCHEDULEPROFILE_HASHMODE_WANTED  -DSTORMCTRL_WANTED -DSTORMCTRL_PPS_WANTED  -DSTORMSUPPR_WANTED  -DPOWER_WANTED -DSLOT_WANTED -DFAN_WANTED -DTEMPERATURE_WANTED -DVOLTAGE_WANTEDxx -DCPU_MONITOR_WANTED -DMEMORY_WANTED -DPOWERDOWN_TRAP_WANTED  -DTIMERANGE_WANTED -DACL_WANTED -DTIMERANGE_ACL_WANTED  -DUDLD_WANTED  -DVLANMAPPING_WANTED -DVLANMAPPING_BOTH_WANTED -DVLANMAPPING_PRI_WANTED -DVLANMAPPING_PRIRANGE_WANTED -DVLANMAPPING_INNER_WANTED -DVLANMAPPING_INNERRANGE_WANTED -DVLANMAPPING_TRUNK_WANTED -DVLANMAPPING_IF_WANTED -DVLANMAPPING_BOTHBOTH_WANTED  -DVTP_WANTED -DVTP_TRUNK_WANTED  -DWRED_WANTED  -DY1731_WANTED  -DVCT_WANTED -DVCT_MANUALMODE_WANTED  -DPATCH_WANTED  -DMLAG_WANTED  -DCFX_WANTED  -DLPF_WANTED  -DANTIDOS_WANTED  -DTELEMETRY_WANTED  -DDXS_WANTED  -DBFD_WANTED -DBFD_ECHO_WANTED -DETHSUBIF_ROUTE_WANTED -DBFD_TRACKIPV6_WANTED -DBFD_LINKBUNDLE_WANTED  -DBGP4_WANTED -DBGP4_IPV6_WANTED -DBGP4_IMPORTRIB_WANTED -DBGP_SPLIT_WANTED  -DDHCP_WANTED -DDHCPS_WANTED -DDHCPR_WANTED -DDHCP_RELAY_USER_WANTEDxx  -DDHCPC_WANTED -DDHCPC_OUTBAND_IF_SUPPORT  -DDHCP6_WANTED -DDHCP6_SERVER_WANTED -DDHCP6_RELAY_WANTED  -DDID_WANTED  -DHWMC_WANTED  -DHWRT_WANTED -DTMP_HWVP_WANTED -DHWROUTE_HWBUFLEN=9600 -DHWRT_HOSTRT_HW  -DHWBD_WANTED  -DIGMPV3_WANTED  -DISIS_WANTED -DISIS_IPV6_WANTED  -DMLDV2_WANTED  -DNTP_WANTED -DNTP6_WANTED  -DOSPF_WANTED -DOSPF_FRR  -DOSPF6_WANTED -DOSPF6_FRR  -DPIM_WANTED -DIGMP_STATIC_VXLAN_PEER_WANTED  -DPIMV6_WANTED  -DPOLICYROUTE_WANTED  -DRIP_WANTED  -DRIPNG_WANTED  -DROUTEPOLICY_WANTED -DIPPREFIX_WANTED -DASPATH_WANTED -DROUTEPOLICY_NMLIB_INC  -DVRRP_WANTED -DVRRPV2_WANTED -DVRRPV3_WANTED  -DEVPN_WANTED  -DL3VPN_WANTED -DL3VPN_IMPORTRIB_WANTED          -DBFD_WANTED -DBFD_ECHO_WANTED -DETHSUBIF_ROUTE_WANTED -DBFD_TRACKIPV6_WANTED -DBFD_LINKBUNDLE_WANTED  -DNETCONF_WANTED -DUSE_NONBLOCKING_IO            -DDHCP6_WANTED -DDHCP6_SERVER_WANTED -DDHCP6_RELAY_WANTED  -DMLINK_WANTED -DMLINK_TRUNK_WANTED -DMLINK_UPLINKBACKUP_WANTED                                  -DSQLITE3_WANTED      -DAUTOCONFIG_WANTED  -DPORTSPLIT_WANTED  -DPATHDETECT_WANTED  -DOSAL_WANTED -DOSIX_INETADDR_WANTED -DOSIX_BOOTPARAM_FILE=\"/tmp/bootparam.sys\" -DRAM_ROOT_DIRECTORY=\"/tmp/ram\" -DMEM_ROOT_DIRECTORY=\"/mnt/mem\" -DFLASH_ROOT_DIRECTORY=\"/mnt\" -DUSR_PATH_DIRECTORY=\"/mnt/nandsim/user\" -DDROPBEAR_ROOT_PATH=\"/mnt/dropbear\" -DMGMT_HUB_MTU=8200    -DPTP_WANTED  -DNQA_WANTED    -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/thd/usr/inc/ros/inc -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/sp -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/bgp -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/sys -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/l2 -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/ui -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/ha -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/l3tm -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/usphal -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/devcom -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/igp -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/ll -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/devm -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/ns -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/bsl -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/nac -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/sha -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/ifm -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/infoc -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/cm -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/devprot -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_plat/interface/ns/machine_include/arm -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_device/code/bcu/inc  -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_device/code/bcu/inc -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_device/code/nfs/inc -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_device/arch/arm64/io/inc -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_device/driver/bcm/ucp/include -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_device/driver/bcm/ucp/include/udr -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_device/driver/bcm/udr/include -I/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_device/driver/bcm/udr/sal/include -Wno-poison-system-directories -Wno-write-strings -Wno-attributes -fasynchronous-unwind-tables -rdynamic -MMD -MP -fPIC -g   --sysroot=/opt/fhlinux/8.2.0-r1//sysroots/aarch64-fhlinux-linux/ -I/opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp/../udr/include -I/opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp/../udr/product/s6900/include -I/opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp/../udr/chip/thd_bcm/6.5.20//include -I/opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp/../../../../USP_OSAL/osal/h -I -DOS=LINUX -DHOST=OSIX_LITTLE_ENDIAN -D__LITTLE_ENDIAN_BITFIELD  --sysroot=/opt/fhlinux/8.2.0-r1//sysroots/aarch64-fhlinux-linux/ -Wl,-T/opt/fiberhome/weijk/tmp/s6900/usp_plat/plat/nm/sys/hotfix/tools/fhp_patch.lds -L/opt/fiberhome/weijk/tmp/s6900/usp_plat/plat/nm/sys/hotfix/machine/arm64 -o uspdriver udr_main_loop.o -Xlinker  "-(" -L/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_device/arch/arm64/rootfs/usr/lib -L/opt/fiberhome/weijk/tmp/s6900/usp_device/make/arm64/../../../usp_device/make/arm64/target/lib  -L/opt/fiberhome/weijk/tmp/s6900/usp_plat/plat/nm/sys/hotfix/machine/arm64 -luspdhcpsnooping -luspisis -luspgrpc -luspmvrp -lusppathdetect -luspnetconfnmlib -luspsmartinstall -luspcrypto -luspstormcontrol -luspvlanmapping -luspndl2proxy -luserio -luspclinm -lusprlink -luspstgshare -luspmacvlan -lusprmon2 -luspy1731 -luspdns -luspantiarp -lusplpf -luspipsg -luspdevice -lfhp_armls1046_64 -lusptelemetrytrap -luspaaa -luspgrpc++ -luspdhcpv6 -luspsoa -leos -luspnetconfcore -luspdhcp -luspmlag -luspdevcomm -luspdot1x -luspifstatistic -luspntp -luspnetconfdev -luspmldsnooping -luspiss -lusppolicyroute -lfhsafe -luspsys -luspdiffserv -luspnetflow -luspospfv2 -lusphwrt -luspipvlan -luspif -lusplldp -lusppim -luspalarm -lusprtadvd -luspl2net -lusphwvp -luspupb -luspbpdutunnel -luspripng -lusprip -luspflush -luspbgp -luspg8032 -luspdriver -luspdhcpclient -luspscheduleprofile -luspdid -lusproutepolicy -luspospfv3 -lusparpndp -luspssl -lusppim6 -luspsqlite3 -luspvrrp -luspudld -luspwred -luspvct -luspmstp -luspsshsvr -luspgpr -lusposal -lusparpprobe -luspmxml -luspportisolate -luspcfx -lusplinkflap -lusptimerange -lusppkt_ntf -luspftp -luspnetconfnotification -lusphotfix -luspportsplit -luspsnmp -luspgrpc_unsecure -luspmad -luspacl -luspalb -luspddm -luspl3vpn -luspmirror -luspqueue -luspvtp -luspigmpsnooping -luspdxs -luspmam -luspstormsuppression -lusp1588v2 -luspdosantiattack -lusptftp -luspantiattack -luspnetstack -luspclicrypt -lusptelemetry -luspuinetsck -lusphwmc -lusparpl2proxy -lusppubcliutil -luspprocshell -luspmeter -luspnqa -lusppppoeplus -luspqinq -luspdot1ag -luspprotovlan -luspdevm -luspevpn -luspcounter -luspxml2 -lusplacp -lros -luspzlib -luspbfd -lusphwbd -luspmlink -luspsnmpv3 -luspmldv2 -luspcliutil -luspigmpv3 -luspprotobuf -luspaddress_sorting -luspcpudefend   -Xlinker "-)" -fasynchronous-unwind-tables -rdynamic -lrt -lm -lz -ldl -pthread -lutil -luspzlib -Xlinker  "-(" -L/opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp/../lib -lxgs -Xlinker "-)" -fasynchronous-unwind-tables -rdynamic -lrt -lm -lz -ldl -pthread -lutil -Wl,--whole-archive -L/opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp/lib/s6900/image_mcsu/linux-rsx-3_6/debug/shared/udr/ -L/opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp/lib/s6900/image_mcsu/linux-rsx-3_6/debug/0.0.0.1/udr -ludr_api -ludr_api_test -ludr_app_main -ludr_bcm_acl -ludr_bcm_bfd -ludr_bcm_counter -ludr_bcm_esm -ludr_bcm_intr -ludr_bcm_l3 -ludr_bcm_led -ludr_bcm_mac -ludr_bcm_mc -ludr_bcm_mirror -ludr_bcm_misc -ludr_bcm_mpls -ludr_bcm_oam -ludr_bcm_pkt -ludr_bcm_port -ludr_bcm_ring -ludr_bcm_route -ludr_bcm_stg -ludr_bcm_system -ludr_bcm_trunk -ludr_bcm_vlan -ludr_bcm_vxlan -ludr_dispatch -ludr_main -ludr_mod_main -ludr_symtab -ludr_product_s6900 -ludr_product_s6900_card_mcsu_s6900_32cq2x -ludr_product_s6900_card_mcsu_s6900_48s8cq -ludr_product_s6900_card_mcsu_s6900_48s8cq2x -ludr_product_s6900_card_mcsu_s6900_48s8cqe -ludr_product_s6900_card_mcsu_s6900_48x6q -ludr_product_s6900_card_mcsu_s6900_48x6q2x -ludr_product_s6900_card_mcsu_s6900_48x6qe -ludr_product_s6900_card_mcsu_s6900_48x8cq -ludr_product_s6900_card_mcsu_s6900_128cq -ludr_product_s6900_card_mcsu_s6900_fh_32cq2x -Wl,--no-whole-archive -fasynchronous-unwind-tables -rdynamic -lrt -lm -ldl -pthread -lutil 
/opt/fhlinux/8.2.0-r1/sysroots/x86_64-fhlinuxsdk-linux/usr/libexec/aarch64-fhlinux-linux/gcc/aarch64-fhlinux-linux/8.2.0/real-ld: /opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp/lib/s6900/image_mcsu/linux-rsx-3_6/debug/shared/udr//libudr_api.a(udr_api_bfd.o): relocation R_AARCH64_ADR_PREL_PG_HI21 against symbol `bfdNotifyProc' which may bind externally can not be used when making a shared object; recompile with -fPIC
/opt/fhlinux/8.2.0-r1/sysroots/x86_64-fhlinuxsdk-linux/usr/libexec/aarch64-fhlinux-linux/gcc/aarch64-fhlinux-linux/8.2.0/real-ld: /opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp/lib/s6900/image_mcsu/linux-rsx-3_6/debug/shared/udr//libudr_api.a(udr_api_bfd.o)(.text+0x6d8): unresolvable R_AARCH64_ADR_PREL_PG_HI21 relocation against symbol `bfdNotifyProc'
/opt/fhlinux/8.2.0-r1/sysroots/x86_64-fhlinuxsdk-linux/usr/libexec/aarch64-fhlinux-linux/gcc/aarch64-fhlinux-linux/8.2.0/real-ld: final link failed: bad value
collect2: error: ld returned 1 exit status
make[3]: *** [uspdriver] Error 1
make[2]: *** [udr_app] Error 2
make[1]: *** [udr_app] Error 2
make[1]: Leaving directory `/opt/fiberhome/weijk/tmp/s6900/usp_device/driver/bcm/ucp'
```

usp_device\driver\common\lib\Makefile文件

```Makefile
LOCALDIR = udr/lib
include ${PROJECT_MAKE}/Make.config

CFLAGS += -I$(UDR_ROOT)/include -I$(PROJECT_ROOT)/include -I../ipc/ -Werror 

LIBTARGET=libuspdriver.so
LIBSOURCE:= udr_driver_lib.c

library:$(LIBTARGET)

ifeq ($(HOTFIX_MODULE),YES)
LIBSOURCE += $(HOTFIX_PATH)/tools/patch_embed.c
CFLAGS += -Wl,-T$(HOTFIX_ARC_LIB_PATH)/fhp_patch.lds -L$(HOTFIX_ARC_LIB_PATH) $(HOTFIX_INC)
endif

$(LIBTARGET):
	$(CC) $(CFLAGS) -fpic -shared -o $(LIBTARGET) $(LIBSOURCE)
	cp -f $(LIBTARGET) $(ROOTFS)/usr/lib
	
clean:
	rm $(TARGET) $(LIBTARGET) -f 
	rm *.o -rf

.PHONY : library clean $(LIBTARGET)

#for commit the file
```

将第17行的`-fpic`改为`-fPIC`即可。
